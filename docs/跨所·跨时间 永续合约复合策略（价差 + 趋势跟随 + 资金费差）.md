# 跨所·跨时间 永续合约复合策略（价差 + 趋势跟随 + 资金费差）

> 目标：在两家永续合约平台（示例：Lighter 与 GRVT）间，先“顺势建仓→锁盈对锁”，随后利用**价差波动**与**资金费差**做“解锁—再锁”的波段化收益，同时确保净 Delta 风控与强平安全边界。

---

## 1) 策略概览

- **核心流程**：  
  1. **S1 开第一腿（顺势）**：Lighter 10× 开多 BTC（也可镜像做空版本）。  
  2. **S2 锁盈对锁**：价格上行至触发线，在 GRVT 10× 开空，同名义仓位，形成对锁。  
  3. **S3 对锁持有**：依据两所**价差带**与**资金费差**，择机解锁一腿，实现波段化落袋；必要时再次锁回。  
  4. **S4/S5 单边管理**：被解锁后以**反抽价/时间/盈亏阈值**完成另一腿的平仓。  
- **盈利来源**：趋势段收益、跨所价差波动、被动成交返佣、资金费差。  
- **成本项**：开平手续费、资金费净支出、滑点/冲击成本、资金/保证金调拨摩擦、极端事件成本（穿仓、ADL）。

---

## 2) 入场与触发（门槛化）

- **入场必须满足以下 3 项中 ≥2 项**：
  - **趋势因子**：`EMA(短) - EMA(长) > θ1` 或 “突破上轨”。  
  - **最小目标收益**：`ΔP >= θ2`（覆盖全部成本并留冗余）。  
  - **资金费差**：`Funding(Lighter) - Funding(GRVT) >= θ3`（方向有利）。  
- **波动区间过滤**：`RealizedVol ∈ [Vmin, Vmax]`（过低=没机会，过高=滑点爆表）。  
- **标记价优先**：触发计算尽量基于“标记价/指数价”。

---

## 3) 状态机（无代码版）

### S0 观察（无仓）
- **条件**：满足“入场门槛（≥2 项）”。  
- **行动**：进入 S1。  

### S1 开第一腿（Lighter 多）
- **下单**：限价被动优先，超时→小滑点追价；  
- **保护**：设硬止损 `SL_1`（如 -0.8% ~ -1.2%）；  
- **转移**：若 `Price ≥ P_lock = P_entry × (1 + g%)` → S2；若击穿 `SL_1` → 平仓回 S0。  

### S2 锁盈（GRVT 空）
- **目标**：形成对锁，净 Delta≈0；  
- **风控**：二腿下不了→**原子回滚**（撤回一腿）或**次优场所补单**（有滑点上限）；  
- **转移**：对锁成功 → S3。  

### S3 对锁持有（做“价差/资金费”的活）
- **监控**：
  - 价差 `Spread = Price_L - Price_G`（或标记价/指数差）；  
  - 资金费窗口（下一时段净支出）。  
- **触发**：  
  - `Spread ≥ UB` → **解锁方案 A**（平 GRVT 空，落袋回撤）；→ S4  
  - `Spread ≤ LB` → **解锁方案 B**（平 Lighter 多，延续趋势）；→ S5  
  - 超时 `T_max` 未触发 → 只保留**资金费更友好**的腿，另一腿减仓。  

### S4 单边（仅 Lighter 多）
- **反弹回补**：到 `P_rebound` 平多 → S0；  
- **兜底**：若不反弹，按**时间/盈亏阈**强制离场。  

### S5 单边（仅 GRVT 空）
- **对称管理**：下行达标平空 → S0；反转则时间/盈亏止损。

---

## 4) 参数模板（首版建议）

| 参数           | 含义                   | 建议起点/说明                         |
| -------------- | ---------------------- | ------------------------------------- |
| `g%`           | 锁盈触发涨幅（开二腿） | `0.35% ~ 0.8%`（≥全成本×1.5）         |
| `θ2`           | 最小目标收益阈值       | `0.25% ~ 0.5%`（随费率/返佣动态调整） |
| `θ1`           | 趋势强度阈值           | 用 EMA/布林/Donchian 之一，回测标定   |
| `θ3`           | 资金费差阈值           | 依据两所历史资金费分布设分位点        |
| `LB/UB`        | 价差带阈值             | 历史分位 `20%/80%` 或 σ 的 `±0.5~1.0` |
| `T_max`        | 对锁最大持有时间       | `2~8h`（避多轮负费叠加）              |
| `SL_1`         | 第一腿硬止损           | `-0.8% ~ -1.2%`（10× 杠杆谨慎）       |
| `Δmax`         | 跨所净 Delta 上限      | `|净敞口| ≤ 10% 名义仓位`             |
| `FeeModel`     | 费率/返佣              | 按账户实际档位/返佣协议建模           |
| `FundingGuard` | 资金费保护             | 净资金费年化 `> X%` 时减仓/切腿       |

> 注：参数为“起飞值”，需用历史重放 + 模拟成交做二次标定。

---

## 5) 风控要点（必开）

1. **强平边界**：逐腿计算强平价与缓冲；使用**隔离保证金**，遇风控信号自动降杠杆/减仓。  
2. **原子下单/回滚**：二腿失败则撤回一腿；提供**次优场所备份**（有滑点/深度预算）。  
3. **滑点预算器**：下单前基于 L2 盘口估算冲击成本，若 > 预算则不触发/降级成交方式（IOC/FOK）。  
4. **资金费日历**：临近结算时段适度抬高触发阈值，避免“刚锁就扣负费”。  
5. **净暴露限额**：跨所净 Delta 超阈即强制对冲或减仓。  
6. **库存/保证金再平**：周期性再平两所可用保证金，避免单侧强平风险。  
7. **异常兜底**：撮合延迟飙升/维护公告/风控报错 → 进入“安全模式”（只减仓不加仓）。

---

## 6) 计算与评估（落地前）

- **期望收益条件**：  
  `趋势段收益 + 资金费差收益 + 价差波段收益 ≥ 手续费 + 滑点 + 资金费净支出 + 风险溢价`  
- **回测与仿真**（两所同时重放）：
  - 数据：1s 或逐笔 L2/Trade、资金费时点、标记价；  
  - 成交：被动/主动混合、撮合延迟、撤单失败率；  
  - 故障：二腿挂不上/卡单、插针、延迟爆表；  
  - 指标：胜率、盈亏/成本比、单位时间收益、最大回撤、资金占用效率、净资金费、滑点分解、对锁失败率。  

---

## 7) 不建议双开的场景

- 两所同时 **负资金费** 且短期难改向；  
- 价差历史波动极低（锁了难解）；  
- 波动过高导致二腿必然高滑点；  
- 某所风控收紧/维护（对锁安全性不足）。

---

## 8) 执行细节建议

- **二腿“带内分批”**：到 `P_lock` 不立刻追市，先在 `[P_lock-ε, P_lock+ε]` 带内分批挂被动单，超时再 IOC；  
- **仓位渐进**：首单 1/3 仓→锁盈→对锁后“加-解-加”做小波段；  
- **价格源**：触发用标记/指数，成交用盘口价，避免异常成交误触；  
- **监控面板**：PnL、净敞口、强平距离、资金费净值、下单失败率、撮合延迟。  

---

## 9) 上线前自检清单

- [ ] 入场门槛（趋势/目标收益/资金费差）≥2  
- [ ] 锁盈触发价 `P_lock` 与分批带宽 `ε`  
- [ ] 价差带 `LB/UB` + 时间 `T_max`  
- [ ] 资金费保护（切腿/减仓）  
- [ ] 原子下单/回滚 + 次优场所  
- [ ] 净 Delta 限额 `Δmax` + 强平边界  
- [ ] 滑点预算器 + 速率限制  
- [ ] 指标监控与告警（PnL/费率/失败/延迟）

---

### 备注
- 该策略可镜像为“先做空再锁盈做多”的对称版本。  
- 实盘需严格遵守各平台 ToS 与监管要求；拒绝任何形式的操纵或违规刷量。